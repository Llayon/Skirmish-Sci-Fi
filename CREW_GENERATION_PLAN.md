# Детальный план по редизайну процесса создания лидера отряда

**Цель:** Преобразовать текущий функциональный, но сухой процесс создания персонажа в увлекательный, интуитивно понятный и визуально привлекательный опыт, который с самого начала погружает игрока в мир игры.

---

### **Шаг 1: Внедрение поля для имени лидера**

-   **Цель:** Дать игроку возможность персонализировать своего персонажа с самого первого шага.
-   **Почему это важно:** Это фундаментальное UX-улучшение. Ввод имени превращает абстрактного "Лидера" в "моего персонажа", мгновенно повышая вовлеченность.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **Состояние:** Добавить новое состояние для имени лидера.
        ```typescript
        const [leaderName, setLeaderName] = useState('Rook'); // Имя по умолчанию
        ```
    -   **UI/Компоненты:** Добавить стилизованное поле ввода `<input>` над основной рабочей областью "мастера". Оно должно быть видно на всех шагах создания лидера.
        ```jsx
        <div className='flex justify-between items-center mb-4'>
          <h2 className="text-xl sm:text-2xl font-bold font-orbitron text-primary">{t('crewCreator.leader.title')}</h2>
          <input
              type="text"
              value={leaderName}
              onChange={(e) => setLeaderName(e.target.value)}
              placeholder="Имя лидера"
              className="bg-surface-base/50 border border-border rounded-md py-1 px-3 text-text-base text-lg font-bold w-48 text-right"
          />
        </div>
        ```

---

### **Шаг 2: Создание базовой структуры для панели "Сводка персонажа"**

-   **Цель:** Заложить основу для динамической панели, которая будет в реальном времени отображать изменения персонажа.
-   **Почему это важно:** Это решает проблему "неочевидности последствий", предоставляя игроку постоянную обратную связь.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **UI/Компоненты:** В правой колонке (где сейчас детальное описание) создать новый компонент `<LeaderSummaryPanel>`. На этом этапе он будет отображать только имя лидера, его портрет-заглушку и базовые характеристики выбранной расы.
    -   **Логика:** Компонент будет принимать `leaderName` и `leaderSelections` в качестве пропсов.
        ```jsx
        // Внутри CrewCreator.tsx
        <div className="md:col-span-2">
            <LeaderSummaryPanel 
                name={leaderName} 
                selections={leaderSelections}
            />
        </div>
        ```

---

### **Шаг 3: Реализация динамического расчета характеристик**

-   **Цель:** "Оживить" панель сводки, чтобы она автоматически пересчитывала и отображала итоговые характеристики персонажа при каждом выборе.
-   **Почему это важно:** Игрок в реальном времени видит, как его решения формируют финальный облик персонажа.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx` (или вынести в кастомный хук `useLeaderBuilder.ts`).
    -   **Логика:** Использовать хук `useMemo` для вычисления итоговых характеристик и бонусов каждый раз, когда изменяется `leaderSelections`.
        ```typescript
        const leaderPreview = useMemo(() => {
            const race = RACES[leaderSelections.raceId];
            const background = CHARACTER_BACKGROUNDS.find(bg => bg.id === leaderSelections.backgroundId);
            // ... и так далее для мотивации и класса

            if (!race) return null; // Или базовое состояние

            // Логика суммирования бонусов от расы, предыстории и т.д.
            let stats = { ...race.baseStats };
            let bonuses = { /* ... */ };

            // ... код для применения эффектов ...

            return { stats, bonuses, /* другая информация */ };
        }, [leaderSelections]);
        ```
    -   **UI/Компоненты:** Передать `leaderPreview` в `<LeaderSummaryPanel>` и отобразить рассчитанные статы.

---

### **Шаг 4: Визуализация изменений характеристик**

-   **Цель:** Сделать увеличение характеристик наглядным и заметным.
-   **Почему это важно:** Визуальная обратная связь (подсветка, анимация) гораздо эффективнее простого изменения цифр.
-   **Техническая реализация:**
    -   **Файлы:** Компонент для отображения статов (например, `StatBar.tsx`), `LeaderSummaryPanel.tsx`.
    -   **UI/Компоненты:** Создать компонент `StatBar`, который будет отображать полоску-индикатор. При изменении характеристики (например, Стойкость 3 -> 4), полоска анимированно увеличивается, а цифра на мгновение подсвечивается.
        ```jsx
        // Внутри LeaderSummaryPanel.tsx
        {leaderPreview && Object.entries(leaderPreview.stats).map(([stat, value]) => (
            <StatBar 
                key={stat} 
                label={t(`characterCard.${stat}`)} 
                value={value} 
                baseValue={RACES[leaderSelections.raceId].baseStats[stat]}
            />
        ))}
        ```

---

### **Шаг 5: Добавление портретов и их выбор**

-   **Цель:** Усилить персонализацию через визуальный образ.
-   **Почему это важно:** Портрет — мощнейший инструмент для создания привязанности к персонажу.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **Ассеты:** Подготовить по 3-5 портретов для каждой расы в папке `public/assets/portraits/`.
    -   **Состояние:** Добавить состояние для отслеживания выбранного портрета.
        ```typescript
        const [portraitUrl, setPortraitUrl] = useState('/assets/portraits/human_veteran_01.webp');
        ```
    -   **UI/Компоненты:** В `<LeaderSummaryPanel>` добавить элемент `<img>` для портрета. Рядом с ним — иконку `RotateCw` (перезагрузка/смена), которая будет циклически менять `portraitUrl` из списка доступных для выбранной расы.

---

### **Шаг 6: Внедрение финального экрана подтверждения ("Review")**

-   **Цель:** Дать игроку возможность оценить свой выбор целиком перед окончательным решением.
-   **Почему это важно:** Это дает чувство завершенности и контроля, позволяя внести последние правки.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **Состояние:** Расширить состояние шага "мастера".
        ```typescript
        const [leaderStep, setLeaderStep] = useState<'race' | 'background' | 'motivation' | 'class' | 'review'>('race');
        ```
    -   **UI/Компоненты:** Создать новую JSX-разметку для шага `'review'`. Она будет скрывать панели выбора и на весь экран показывать финальную карточку персонажа со всеми данными: имя, портрет, итоговые статы, список правил и все стартовые бонусы для кампании.
    -   **Логика:** Кнопка "Далее" на шаге "Класс" теперь будет называться "Просмотр" и устанавливать `setLeaderStep('review')`.

---

### **Шаг 7: Реализация навигации на экране подтверждения**

-   **Цель:** Обеспечить возможность вернуться к редактированию с экрана подтверждения.
-   **Почему это важно:** Без возможности вернуться экран подтверждения теряет половину своей ценности.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **UI/Компоненты:** На экране `'review'` добавить две кнопки:
        1.  `"Подтвердить и собрать отряд"` (финальная кнопка).
        2.  `"Назад к редактированию"`.
    -   **Логика:** Кнопка "Назад" будет устанавливать `setLeaderStep('class')`, возвращая пользователя на последний шаг редактирования. Финальная кнопка вызовет `handleConfirmLeader()`, которая переключит `creationStep` на `'assemble'`.

---

### **Шаг 8: Стилизация списков выбора**

-   **Цель:** Заменить стандартные списки на более тематические и интерактивные элементы.
-   **Почему это важно:** Это ключевое визуальное улучшение, которое превращает "форму" в "игровой интерфейс".
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **UI/Компоненты:** Вместо простого `.map()` по массиву `<Card>`, создать стилизованный компонент `<SelectionCard>`. Он может включать иконку расы/класса, короткое название и иметь уникальный `hover`-эффект. При выборе (`onClick`), он получает яркую рамку или подсветку.
        ```jsx
        // Вместо <Card>
        <SelectionCard 
            label={opt.label} 
            icon={/* ... */} 
            isSelected={selectedValue === opt.value}
            onClick={() => handleLeaderSelection(selectionKey, opt.value)}
        />
        ```

---

### **Шаг 9: Рефакторинг и вынос логики в хелперы**

-   **Цель:** Очистить компонент `CrewCreator.tsx` от сложной бизнес-логики.
-   **Почему это важно:** Это улучшает читаемость, тестируемость и поддерживаемость кода — признак работы старшего инженера.
-   **Техническая реализация:**
    -   **Файлы:** Создать новый файл `services/characterBuilder.ts` или кастомный хук `hooks/useLeaderBuilder.ts`.
    -   **Логика:** Перенести функцию расчета динамических характеристик и бонусов (`calculateDynamicStats`) из `useMemo` в этот новый файл. `CrewCreator` будет импортировать и вызывать эту функцию, передавая ей `leaderSelections`.

---

### **Шаг 10: Добавление функции "Случайный персонаж"**

-   **Цель:** Предоставить "quality of life" улучшение для быстрого старта.
-   **Почему это важно:** Уважаем время игрока и предоставляем альтернативный, более быстрый способ начать игру.
-   **Техническая реализация:**
    -   **Файлы:** `CrewCreator.tsx`.
    -   **UI/Компоненты:** На первом шаге (`'race'`) добавить небольшую кнопку-иконку с игральными костями.
    -   **Логика:** Создать новую функцию `handleRandomizeLeader()`. Эта функция будет:
        1.  Случайным образом выбирать по одному элементу из массивов `raceOptions`, `backgroundOptions`, `motivationOptions`, `classOptions`.
        2.  Обновлять состояние `setLeaderSelections` этими случайными значениями.
        3.  Автоматически переключать на экран подтверждения: `setLeaderStep('review')`.

Этот план превращает редизайн из абстрактной идеи в серию конкретных, измеримых и последовательных задач.